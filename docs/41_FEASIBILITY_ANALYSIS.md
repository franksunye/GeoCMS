# 升级可行性分析与研发 Backlog

## 📊 可行性评估结论

**推荐方案：基于现有项目升级（可行性：85%）**

### 核心理由

1. **已有坚实基础**
   - ✅ 完整的 AI Native 多 Agent 架构（Planner + Writer + Verifier）
   - ✅ 成熟的知识库系统（KnowledgeBase 模型 + 服务层）
   - ✅ 状态驱动的对话系统（StateManager + AgentCoordinator）
   - ✅ 完整的测试体系（195+ 测试，100% 通过率）
   - ✅ 清晰的模块化设计（API/Services/Agents 分层）

2. **架构高度契合**
   - 当前：Planner Agent → Writer Agent → Verifier Agent
   - 目标：知识库 Agent → 策划 Agent → 生成 Agent
   - **差距小**：主要是职责调整和功能增强，而非重构

3. **技术栈一致**
   - FastAPI + SQLAlchemy + LangChain 已就绪
   - 知识库检索机制已实现（需增强为向量检索）
   - 多轮对话和状态管理已完善

4. **风险可控**
   - 向后兼容性设计已到位
   - 增量升级路径清晰
   - 测试覆盖率高，回归风险低

---

## 🔍 当前架构 vs 目标架构对比

| 维度 | 当前架构 | 目标架构 | 升级难度 |
|------|---------|---------|---------|
| **知识库** | 基础 CRUD + 简单检索 | 向量检索 + 素材包生成 | ⭐⭐⭐ 中等 |
| **策划能力** | Planner Agent（槽位询问） | 策划 Agent（内容计划生成） | ⭐⭐ 较低 |
| **生成能力** | Writer Agent（内容生成） | 生成 Agent（草稿+格式化） | ⭐ 低 |
| **人机协同** | 多轮对话（槽位填充） | HITL（编辑/审核/发布） | ⭐⭐⭐ 中等 |
| **数据模型** | 完整（Runs/Tasks/KB） | 需增加草稿/审核表 | ⭐⭐ 较低 |
| **前端界面** | Streamlit 对话界面 | 需增加编辑器/审核界面 | ⭐⭐⭐⭐ 较高 |

**总体评估**：70% 的功能可复用，30% 需新增或增强

---

## ⚠️ 重新创建项目的风险

如果选择重新创建项目，将面临：

1. **时间成本高**
   - 重建基础架构：2-3 周
   - 重建知识库系统：1-2 周
   - 重建测试体系：1-2 周
   - **总计：4-7 周 vs 升级仅需 2-3 周**

2. **质量风险**
   - 丢失已验证的设计模式
   - 需重新发现和修复 bug
   - 测试覆盖率从零开始

3. **业务连续性**
   - 现有功能无法平滑迁移
   - 用户体验断层

**结论：不推荐重新创建项目**

---

## 🎯 研发 Backlog（MVP 阶段）

### Sprint 1：知识库 Agent 增强（0-2 周）

#### S1.1 向量检索能力
- [ ] **S1.1.1** 技术选型：ChromaDB vs LlamaIndex vs Pinecone
- [ ] **S1.1.2** 集成向量数据库（推荐 ChromaDB，轻量级）
- [ ] **S1.1.3** 实现知识分块和向量化（Embedding）
- [ ] **S1.1.4** 实现语义检索接口
- [ ] **S1.1.5** 测试：检索准确率和性能

#### S1.2 素材包生成
- [ ] **S1.2.1** 设计素材包数据结构（JSON Schema）
- [ ] **S1.2.2** 实现基于主题的素材聚合逻辑
- [ ] **S1.2.3** 实现素材摘要和过滤
- [ ] **S1.2.4** API：`POST /api/knowledge/material-pack`
- [ ] **S1.2.5** 测试：素材包质量验证

#### S1.3 知识库管理界面优化
- [ ] **S1.3.1** 批量导入知识（CSV/JSON/Markdown）
- [ ] **S1.3.2** 知识分类和标签管理
- [ ] **S1.3.3** 知识预览和编辑优化

**验收标准**：
- 向量检索响应时间 < 500ms
- 素材包包含 3-5 个相关知识片段
- 支持批量导入 100+ 条知识

---

### Sprint 2：策划 Agent 升级（2-4 周）

#### S2.1 内容计划生成
- [ ] **S2.1.1** 设计内容计划数据模型（ContentPlan 表）
- [ ] **S2.1.2** 升级 Planner Agent Prompt（增加计划生成逻辑）
- [ ] **S2.1.3** 实现计划生成函数（标题/关键词/大纲/风格）
- [ ] **S2.1.4** 集成知识库素材包到计划生成
- [ ] **S2.1.5** API：`POST /api/planner/create-plan`

#### S2.2 用户交互和反馈
- [ ] **S2.2.1** 计划草案展示界面
- [ ] **S2.2.2** 计划编辑功能（标题/大纲/关键词）
- [ ] **S2.2.3** 计划确认/拒绝机制
- [ ] **S2.2.4** 反馈记录（用于后续优化）
- [ ] **S2.2.5** API：`PATCH /api/planner/plans/{id}`

#### S2.3 多场景支持
- [ ] **S2.3.1** 博客文章计划模板
- [ ] **S2.3.2** 主站页面计划模板
- [ ] **S2.3.3** 产品介绍计划模板

**验收标准**：
- 生成计划包含完整的标题/关键词/大纲
- 用户可编辑计划的所有字段
- 支持 3 种内容类型的计划生成

---

### Sprint 3：生成 Agent 升级（4-6 周）

#### S3.1 草稿生成增强
- [ ] **S3.1.1** 设计草稿数据模型（ContentDraft 表）
- [ ] **S3.1.2** 升级 Writer Agent Prompt（品牌语调注入）
- [ ] **S3.1.3** 实现基于计划的草稿生成
- [ ] **S3.1.4** 支持 Markdown/HTML 输出格式
- [ ] **S3.1.5** 配图建议生成（可选）

#### S3.2 品牌一致性
- [ ] **S3.2.1** 品牌语调配置（BrandVoice 表）
- [ ] **S3.2.2** 关键词标准管理
- [ ] **S3.2.3** 语调注入到生成 Prompt
- [ ] **S3.2.4** 一致性检测（关键词覆盖率）

#### S3.3 版本管理
- [ ] **S3.3.1** 草稿版本记录（DraftVersion 表）
- [ ] **S3.3.2** 版本对比功能
- [ ] **S3.3.3** 回滚到历史版本

**验收标准**：
- 草稿包含品牌关键词（覆盖率 > 80%）
- 支持 Markdown 和 HTML 两种格式
- 保存至少 3 个历史版本

---

### Sprint 4：HITL 流程（6-8 周）

#### S4.1 编辑界面
- [ ] **S4.1.1** 富文本编辑器集成（推荐 TipTap 或 Quill）
- [ ] **S4.1.2** Markdown 编辑器（推荐 CodeMirror）
- [ ] **S4.1.3** 实时预览功能
- [ ] **S4.1.4** 编辑历史追踪

#### S4.2 审核流程
- [ ] **S4.2.1** 审核状态管理（草稿/待审核/已批准/已拒绝）
- [ ] **S4.2.2** 审核意见记录
- [ ] **S4.2.3** 审核通知机制（可选）
- [ ] **S4.2.4** API：`POST /api/drafts/{id}/review`

#### S4.3 发布准备
- [ ] **S4.3.1** 导出为 Markdown/HTML 文件
- [ ] **S4.3.2** 发布检查清单（标题/关键词/格式）
- [ ] **S4.3.3** 发布记录（PublishLog 表）
- [ ] **S4.3.4** 发布后反馈收集（可选）

**验收标准**：
- 编辑器支持富文本和 Markdown 两种模式
- 审核流程完整（草稿 → 审核 → 发布）
- 可导出标准格式文件

---

### Sprint 5：集成测试与优化（8-10 周）

#### S5.1 端到端测试
- [ ] **S5.1.1** 完整流程测试（知识库 → 计划 → 草稿 → 发布）
- [ ] **S5.1.2** 多场景测试（博客/主站/产品介绍）
- [ ] **S5.1.3** 性能测试（响应时间/并发）
- [ ] **S5.1.4** 边界测试（缺失知识/错误输入）

#### S5.2 用户体验优化
- [ ] **S5.2.1** 进度指示器（知识库 → 计划 → 草稿）
- [ ] **S5.2.2** 错误提示优化
- [ ] **S5.2.3** 加载状态优化
- [ ] **S5.2.4** 移动端适配（可选）

#### S5.3 文档和培训
- [ ] **S5.3.1** 用户操作手册
- [ ] **S5.3.2** API 文档更新
- [ ] **S5.3.3** 视频教程（可选）
- [ ] **S5.3.4** FAQ 文档

**验收标准**：
- 端到端测试通过率 100%
- 平均响应时间 < 3 秒
- 用户文档完整

---

## 🔧 技术债务和优化（后续迭代）

### 数据库升级
- [ ] SQLite → PostgreSQL（生产环境）
- [ ] 数据库索引优化
- [ ] 查询性能优化

### 前端重构
- [ ] Streamlit → React/Next.js（更好的用户体验）
- [ ] 组件化设计
- [ ] 状态管理（Redux/Zustand）

### 监控和日志
- [ ] 日志系统（结构化日志）
- [ ] 性能监控（APM）
- [ ] 错误追踪（Sentry）

### 安全和权限
- [ ] 用户认证（JWT）
- [ ] 角色权限管理（RBAC）
- [ ] 数据加密

---

## 📅 时间估算

| Sprint | 功能 | 预计时间 | 优先级 |
|--------|------|---------|--------|
| Sprint 1 | 知识库 Agent 增强 | 2 周 | P0 |
| Sprint 2 | 策划 Agent 升级 | 2 周 | P0 |
| Sprint 3 | 生成 Agent 升级 | 2 周 | P0 |
| Sprint 4 | HITL 流程 | 2 周 | P0 |
| Sprint 5 | 集成测试与优化 | 2 周 | P0 |
| **总计** | **MVP 完成** | **10 周** | - |

**关键里程碑**：
- Week 2：知识库向量检索可用
- Week 4：内容计划生成可用
- Week 6：草稿生成可用
- Week 8：完整 HITL 流程可用
- Week 10：MVP 上线

---

## ✅ 最终建议

### 推荐方案：基于现有项目升级

**理由**：
1. 70% 功能可复用，节省 4-5 周开发时间
2. 已验证的架构和测试体系，质量有保障
3. 平滑升级路径，业务连续性好
4. 技术栈一致，学习成本低

### 关键成功因素

1. **保持敏捷**：每个 Sprint 独立可交付
2. **测试驱动**：先写测试再写实现
3. **用户反馈**：每个 Sprint 后收集反馈
4. **文档同步**：代码和文档同步更新

### 风险缓解

1. **技术风险**：向量数据库选型 → 先做 PoC 验证
2. **性能风险**：响应时间 → 设置性能基准和监控
3. **用户体验风险**：界面复杂度 → 渐进式增强，保持简洁
4. **数据安全风险**：敏感信息 → 早期引入权限和加密

---

## 🚀 下一步行动

1. **立即启动**：Sprint 1 - 知识库 Agent 增强
2. **技术调研**：ChromaDB vs LlamaIndex（1-2 天）
3. **架构细化**：素材包数据结构设计（1 天）
4. **团队对齐**：Backlog 评审和任务分配（1 天）

